<div id="assignments-component">
  <ngb-alert *ngIf="error" [type]="'danger'" (closed)="error = ''">
    <i class="fa fa-exclamation-triangle"></i>
    {{ error }}
    &nbsp;
  </ngb-alert>
  <div class="row mt-3">
    <div class="col-10">
      <div class="col-2">
        <select
          class="form-select"
          [(ngModel)]="statusSelected"
          (ngModelChange)="onStatusFilterChange()"
        >
          <option value="">All Status</option>
          <option *ngFor="let status of allStatus" value="{{ status.code }}">
            {{ status.label }}
          </option>
        </select>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-10">
      <table class="table table-hover">
        <caption>
          {{
            total
          }}
          assignments found
        </caption>
        <thead>
          <tr>
            <th>Task</th>
            <th>Note</th>
            <th>Deadline</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let assignment of assignments">
            <td>
              <button
                class="btn btn-link"
                [routerLink]="'/tasks/' + assignment.task.id"
              >
                {{ assignment.task.title }}
              </button>
            </td>
            <td>{{ assignment.note }}</td>
            <td>{{ assignment.deadline | date: "MMM d, y" }}</td>
            <td>
              <select
                #statusOption
                class="form-select"
                (change)="onStatusChange(statusOption.value, assignment)"
              >
                <option
                  *ngFor="let status of allStatus"
                  [attr.selected]="
                    assignment.status.code === status.code
                      ? 'selected'
                      : undefined
                  "
                  value="{{ status.code }}"
                >
                  {{ status.label }}
                </option>
              </select>
            </td>
            <td>
              <div class="float-end me-5">
                <strong>{{ assignment.totalTime | formatDuration }}</strong>
                <button
                  type="button"
                  class="btn btn-light btn-sm ms-2"
                  title="Start New"
                  (click)="startNewEntry(assignment)"
                >
                  <i class="fa fa-play"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
